<!--<p style="color: green"><%#= notice %></p>-->
<script src="https://code.jquery.com/jquery-3.5.1.slim.min.js" integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj" crossorigin="anonymous"></script>
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>
<script src="http://code.jquery.com/jquery-latest.js"></script>
<%= render @post %>

<h1>Comments</h1>

<% @post.comments.each do |comment| %>
<%= render comment %>
<% end %>
<table><tbody><tr><td>
<% if @post.tags.length>0 %>
  <strong>Tags:</strong>
  <% @post.tags.each do |tag| %>
    <%= link_to tag, style:"text-decoration:none" , class: "btn btn-primary" do %>
      <span class="tag"><%= tag.name %></span>
    <% end %>
  <% end %>
<% end %></td>
<td>

  <%= form_with(model: [@topic, @post]) do |f| %>
    <%= f.fields_for :tags,@post.tags.build do |field| %>
      <%= field.label "New Tag" %>
      <%= field.text_field :name %>
    <% end %>
    <%= f.label "Tags" %>
    <%= f.collection_select :tag_ids,Tag.all,:id,:name,{},{multiple: true}%>
    <%= f.submit "Add" %>
  <% end %>
</td></tr></tbody></table>
<% @post.ratings.each do |r| %>
  <p>
<!--    <strong>Rating:</strong>-->
    <%#= r.num %>
  </p>
<% end %>
<strong>Rating:</strong><br><br>
<% (1..5).each do |t| %>
  <%= t %> Star
  <% y=@post.ratings.group(:num).where(num: t).count %>
  <% y=y.delete(t) %>=
  <% if y.is_a? Numeric  %>
    <%= y %>
  <% else %>
    <%= "0" %>
  <% end %><br>
<% end %>
<br>
<div class="field">
<%= form_with model: [@topic,@post,@post.ratings.build] do |f| %>
    <strong>Give Rating to the Post:</strong>
      <%= f.radio_button :num, 1 %>1
      <%= f.radio_button :num, 2 %>2
      <%= f.radio_button :num, 3 %>3
      <%= f.radio_button :num, 4 %>4
      <%= f.radio_button :num, 5 %>5
  <%= f.submit "Rate" %>
<% end %>
</div>
<br>
<% if params[:topic_id]%>
<div>
  <%= link_to "New Comment", new_topic_post_comment_path(@topic,@post) %>
  <% if can? :update, @post %>
    | <%= link_to "Edit this post", edit_topic_post_path([@topic, @post]) %> |
  <% end %>

<br><br>
  <%= link_to "Back to post", topic_posts_path(@topic) %>
</div>
<% else %>
  <%= link_to "New Comment", new_topic_post_comment_path(@post.topic,@post) %> |
  <%= link_to "Back to topic", topic_path(@post.topic) %> |
  <%= link_to "Edit this post", edit_post_path(@post) %> |
  <%= link_to "Back to posts", topic_posts_path(@post.topic) %>

  <%= button_to "Destroy this post", @post, method: :delete %>
<% end %>